<style>
body { margin: 0; }
</style>
<body>
<script src="three.js"></script>
<script>
var scene, camera, renderer;
var geometry, material, mesh;
var texloader = new THREE.TextureLoader();
var textures = [], count = 40, loaded = 0;
for (var j = 0; j < count; ++j) {
  (function(j) {
    texloader.load('val.' + j + '.tex.jpg', function(tex) {
      console.log('loaded texture', j);
      textures[j] = tex;
      loaded += 1;
      if (loaded == count) { start(); }
    });
  })(j);
}

function start() {
  init();
  animate();
}

function init() {
  var x, y, n, s = 256, x0, y0, x1, y1, eps = 1.0/1024;
  scene = new THREE.Scene();
  camera = new THREE.PerspectiveCamera(
      75,
      window.innerWidth / window.innerHeight,
      1,
      10000
  );
  camera.position.z = 1000;
  geometry = new THREE.Geometry();
  var uvs = [];
  geometry.faceVertexUvs[0] = [];
  for (y = 0; y < 16; ++y) {
    for (x = 0; x < 16; ++x) {
      n = geometry.vertices.length;
      x0 = (x - 8) * s;
      y0 = (y - 8) * s;
      x1 = x0 + (s / 2);
      y1 = y0 + (s / 2);
      geometry.vertices.push(new THREE.Vector3(x0, y0, 0))
      geometry.vertices.push(new THREE.Vector3(x1, y0, 0))
      geometry.vertices.push(new THREE.Vector3(x0, y1, 0))
      geometry.vertices.push(new THREE.Vector3(x1, y1, 0))
      uvs.push(new THREE.Vector2(x / 16 + eps, y / 16 + eps));
      uvs.push(new THREE.Vector2((x + 1) / 16 - eps, y / 16 + eps));
      uvs.push(new THREE.Vector2(x / 16 + eps, (y + 1) / 16 - eps));
      uvs.push(new THREE.Vector2((x + 1) / 16 - eps, (y + 1) / 16 - eps));
      geometry.faces.push(new THREE.Face3(n, n + 1, n + 3));
      geometry.faces.push(new THREE.Face3(n, n + 3, n + 2));
      geometry.faceVertexUvs[0].push([uvs[n], uvs[n + 1], uvs[n + 3]]);
      geometry.faceVertexUvs[0].push([uvs[n], uvs[n + 3], uvs[n + 2]]);
    }
  }
  material = new THREE.MeshBasicMaterial(
      // { color: 0xff0000, wireframe: true }
     { map: textures[3], side: THREE.DoubleSide }
  );

  mesh = new THREE.Mesh(geometry, material);
  scene.add(mesh);

  renderer = new THREE.WebGLRenderer();
  renderer.setSize(window.innerWidth, window.innerHeight);
  document.body.appendChild(renderer.domElement);
}

function animate() {
  requestAnimationFrame(animate);
  mesh.rotation.x += 0.003;
  mesh.rotation.y += 0.007;
  renderer.render(scene, camera);
}

</script>
